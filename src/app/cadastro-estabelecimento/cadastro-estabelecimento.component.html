<body class="body">
    <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
            <a class="nav-item nav-link active" id="nav-home-tab"
                data-toggle="tab" href="#nav-home" role="tab"
                aria-controls="nav-home" aria-selected="true">Dados</a>
            <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab"
                href="#nav-profile" role="tab" aria-controls="nav-profile"
                aria-selected="false">Anexos</a>
        </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade show active" id="nav-home" role="tabpanel"
            aria-labelledby="nav-home-tab">
            <div class="row estilo" style="margin-left: 2%; margin-right: 2%;">
                <div class="col-md-1"></div>
                <div class="col-md-10 border">
                    <div class="responsiva" style="margin-bottom: 50px;">
                        <h1 class="text-center">{{titulo}}</h1>
                        <h4 class="text-center" style="margin-bottom: 25px;">
                            Campos com (*) são obrigatórios </h4>
                    </div>
                    <form method="post" [formGroup]="estabelecimentoForm">
                        <fieldset>

                            <div class="row">
                                <div class="form-group col-md-3">
                                    <b>Data Inspeção:</b>
                                    <input class="form-control"
                                        formControlName="data_inspecao"
                                        name="data_inspecao" type="date">
                                </div>

                                <div class="form-group col-md-3">
                                    <b>Data Retorno:</b>
                                    <input class="form-control" disabled
                                        formControlName="data_retorno"
                                        name="data_retorno" type="date">
                                </div>
                                <div class="form-group col-md-5">
                                    <b>*Status da Licença:</b>
                                    <div>
                                        <div
                                            class="custom-control custom-radio custom-control-inline">
                                            <input type="radio" value="0"
                                                id="customRadioInline1"
                                                name="status"
                                                formControlName="status"
                                                class="custom-control-input">
                                            <label class="custom-control-label"
                                                for="customRadioInline1">Inativo</label>
                                        </div>
                                        <div
                                            class="custom-control custom-radio custom-control-inline">
                                            <input type="radio" value="-1"
                                                id="customRadioInline2"
                                                name="status"
                                                formControlName="status"
                                                class="custom-control-input">
                                            <label class="custom-control-label"
                                                for="customRadioInline2">Ativo</label>
                                        </div>
                                        <div
                                            class="custom-control custom-radio custom-control-inline">
                                            <input type="radio" value="1"
                                                id="customRadioInline3"
                                                name="status"
                                                formControlName="status"
                                                class="custom-control-input">
                                            <label class="custom-control-label"
                                                for="customRadioInline3">Documentação
                                                Pendente</label>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="form-group col-md-3">
                                    <b>*Tipo Pessoa:</b>
                                    <div id="alvo">
                                        <select name="pessoa" id="select"
                                            formControlName="pessoa"
                                            (change)="mascaracnpj()"
                                            class="custom-select"
                                            [ngClass]="{'form-submitted': formSubmitted}">
                                            <option value="1" selected>Pessoa
                                                Juridica</option>
                                            <option value="0">Pessoa Fisica
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <b>Nº da Licença</b>
                                    <div class="input-group">
                                        <input class="form-control"
                                            type="number"
                                            [(ngModel)]="textSearch"
                                            formControlName="licenca"
                                            name="licenca"
                                            (keyup)="numLicenca()">
                                        <div class="input-group-prepend"
                                            *ngIf="!estabelecimentoForm.value.licenca">
                                            <input type="button"
                                                class="btn btn-info"
                                                (click)="solicitarNumeroLicenca()"
                                                value="Solicitar">
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group col-md-3">
                                    <b>Validade:</b>
                                    <input class="form-control" disabled
                                        formControlName="data_licenca"
                                        type="date" name="data_licenca">
                                </div>

                                <div class="form-group col-md-3">
                                    <b>*CNPJ ou CPF:</b>
                                    <input class="form-control"
                                        formControlName="cnpj"
                                        [textMask]="{mask: cnpj}" name="cnpj"
                                        [ngClass]="{'form-submitted': formSubmitted}">
                                </div>

                            </div>
                            <div class="row">
                                <div class="form-group col-md-2">
                                    <b>IE ou RG</b>
                                    <input class="form-control"
                                        formControlName="insc" name="ieourg">
                                </div>
                                <div class="form-group col-md-5">
                                    <b>*Nome Fantasia:</b>
                                    <input class="form-control"
                                        formControlName="fantasia"
                                        name="fantasia"
                                        [ngClass]="{'form-submitted': formSubmitted}">
                                </div>
                                <div class="form-group col-md-5">
                                    <b>*Razão Social:</b>
                                    <input class="form-control"
                                        formControlName="razao" name="razao"
                                        [ngClass]="{'form-submitted': formSubmitted}">
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-md-4">
                                    <b>E-mail:</b>
                                    <input class="form-control"
                                        formControlName="email" name="email">
                                </div>

                                <div class="form-group col-md-5">
                                    <b>*Endereço:</b>
                                    <input class="form-control"
                                        formControlName="endereco"
                                        name="endereco"
                                        [ngClass]="{'form-submitted': formSubmitted}">
                                </div>
                                <div class="form-group col-md-3">
                                    <b>*Bairro:</b>
                                    <input class="form-control"
                                        formControlName="bairro" name="bairro"
                                        type="text"
                                        [ngClass]="{'form-submitted': formSubmitted}">
                                </div>
                            </div>

                            <div class="row">

                                <div class="form-group col-md-2">
                                    <b>CEP:</b>
                                    <input class="form-control"
                                        [textMask]="{mask: cep}"
                                        formControlName="cep" name="cep"
                                        type="text">
                                </div>
                                <div class="form-group col-md-4">
                                    <b>Ponto de Referência:</b>
                                    <input class="form-control"
                                        formControlName="pref" name="pref"
                                        type="text">
                                </div>

                                <div class="form-group col-md-3">
                                    <b>*Telefone:</b>
                                    <input class="form-control"
                                        [textMask]="{mask: telefone}"
                                        formControlName="telefone"
                                        name="telefone"
                                        [ngClass]="{'form-submitted': formSubmitted}">
                                </div>

                                <div class="form-group col-md-3">
                                    <b>Celular:</b>
                                    <input class="form-control"
                                        [textMask]="{mask: celular}"
                                        formControlName="celular"
                                        name="celular">
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-md-9">
                                    <b>*CNAE:</b>
                                    <select name="opcoes" id="cnae"
                                        formControlName="cnae"
                                        class="custom-select"
                                        [ngClass]="{'form-submitted': formSubmitted}">
                                        <option *ngFor="let cnae of CNAE"
                                            value="{{cnae.id}}">{{cnae.codigo +"
                                            - "+cnae.descricao}}</option>
                                    </select>
                                </div>

                                <div class="form-group col-md-3">
                                    <b>*Atividade:</b>
                                    <select name="opcoes" id="atividade"
                                        formControlName="atividade"
                                        class="custom-select"
                                        [ngClass]="{'form-submitted': formSubmitted}">
                                        <option
                                            *ngFor="let atividade of Atividade"
                                            value="{{atividade.id}}">
                                            {{atividade.atividade}}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-md-6">
                                    <b>Obeservação Estabelecimento:</b>
                                    <textarea class="form-control"
                                        formControlName="obs" name="obs"
                                        type="text"> </textarea>
                                </div>

                                <div class="form-group col-md-6">
                                    <b>Obeservação da Licença:</b>
                                    <textarea class="form-control"
                                        formControlName="obs_licenca"
                                        name="obs_licenca"
                                        type="text"></textarea>
                                </div>

                            </div>
                            <div class="row">
                            </div>
                            <div class="row" class="text-center">
                                <div *ngIf="idupdate == null">
                                    <button type="button" class="btn btn-dark"
                                        value="Cadastrar" (click)="salvar()">
                                        <span
                                            class="spinner-border spinner-border-sm"
                                            role="status"
                                            [ngClass]="{ spinnerLoading: loadingCadastro }"
                                            aria-hidden="true"></span>
                                        <i [ngClass]="{ spinnerLoading: !loading }"
                                            aria-hidden="true"></i> Cadastrar
                                    </button>
                                </div>
                                <div *ngIf="idupdate > 0" class="text-center">
                                    <button type="submit" class="btn btn-dark"
                                        value="Atualizar" (click)="atualizar()">
                                        <span
                                            class="spinner-border spinner-border-sm"
                                            role="status"
                                            [ngClass]="{ spinnerLoading: loadingCadastro }"
                                            aria-hidden="true"></span>
                                        <i [ngClass]="{ spinnerLoading: !loading }"
                                            aria-hidden="true"></i> Atualizar
                                    </button>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-profile" role="tabpanel"
            aria-labelledby="nav-profile-tab">
            <div style="margin-left: 2%; margin-right: 2%;">
                <div style="margin-top:10px;">
                    <input type="file" id="teste" style="display: block;"
                        class="text-center" (change)="onUploadChange($event)"
                        accept=".png, .jpg, .jpeg, .pdf, .docx" multiple>
                </div>
                <div class="col-md-12" style="margin-left: 20px;">
                    <div class="row">
                        <div class=" t col-md-3"
                            *ngFor="let item of base64textString; let i = index"
                            style="max-width: 285px;">
                            <div class="card-header text-right col-md-12">
                                <i class="fa fa-times" aria-hidden="true "
                                    (click)="removerDaLista(i) "></i>
                            </div>
                            <div class="card">
                                <div>
                                    <button
                                        *ngIf="arq[i]==='image/png' || arq[i]==='image/jpeg' "
                                        data-toggle="modal"
                                        data-target=".bd-example-modal-lg"
                                        (click)="verAnexoCarregado(i)">
                                        <img class="text-center "
                                            src='data:image/png;base64,{{base64textString[i]}}'
                                            alt=" " class="cad-img-top "
                                            id="img " style="max-width: 100%; max-height: 80px;
                                        min-width: 80px; ">
                                    </button>

                                    <i *ngIf="arq[i]==='application/pdf' "
                                        class="text-center "
                                        class="fa fa-file-pdf-o fa-5x "></i>
                                    <i *ngIf="arq[i]==='application/vnd.openxmlformats-officedocument.wordprocessingml.document' "
                                        class="text-center "
                                        class="fa fa-file-word-o fa-5x "
                                        aria-hidden="true "></i>
                                    <p style="margin-top: 10px; ">
                                        {{nomeArquivo[i]}}</p>

                                </div>
                                <input class="form-control " type="text "
                                    [(ngModel)]="descricao[i] "
                                    placeholder="Adicionar Descrição "
                                    name="descricao_completa ">
                                <button class="btn btn-dark form-control "
                                    id="btn " value="Enviar Arquivo "
                                    (click)="enviar(item, i) ">
                                    <span
                                        class="spinner-border spinner-border-sm "
                                        role="status "
                                        [ngClass]="{ spinnerLoading: loading[i]} "
                                        aria-hidden="true "></span>
                                    <i [ngClass]="{ spinnerLoading: !loading } "
                                        aria-hidden="true "></i> Enviar Arquivo
                                </button>

                            </div>
                        </div>
                    </div>
                    <div *ngIf="base64textString.length> 1" class="text-center">
                        <input type="submit" class="btn btn-dark"
                            value="Enviar Arquivos" (click)="enviarTodos()">
                    </div>
                </div>
                <div class="col-md-12"
                    style="border-top: 1px solid #bdc3c7; margin-top: 50px; margin-left: 0px !important;">
                    <div style="margin-top: 10px;">
                        <a (click)=" ListaArq()">
                            <i [ngClass]="{ spinnerLoading: !loadingNumvem }"
                                class="fa fa-cloud-download fa-2x"
                                aria-hidden="tue"></i>
                            <span class="spinner-border spinner-border-sm"
                                role="status"
                                [ngClass]="{ spinnerLoading: loadingNumvem }"
                                aria-hidden="true"
                                style="margin-right: 15px;"></span> Visualizar
                            arquivos já armazenados
                        </a>
                    </div>

                    <div style="margin-left: 20px;">
                        <div class="row">
                            <div class="t col-md-3" style="max-width: 280px"
                                *ngFor="let item of listaArq; let i = index">
                                <div>
                                    <div class="card-header text-right">
                                    </div>
                                    <div class="card">
                                        <div>
                                            <button
                                                *ngIf="item.type === 'png' || item.type === 'jpeg'"
                                                data-toggle="modal"
                                                data-target=".bd-example-modal-lg"
                                                (click)="verAnexo(item)">
                                                <img *ngIf="item.type ==='jpeg'"
                                                    class="text-center cad-img-top"
                                                    [src]="item.url_location"
                                                    id="img "
                                                    style="max-width: 100%; max-height: 80px; min-width: 80px;" />
                                            </button>
                                            <a [href]="item.url_location"
                                                target="_blank"
                                                rel="noopener noreferrer">
                                                <i *ngIf="item.type ==='pdf' "
                                                    class="text-center "
                                                    class="fa fa-file-pdf-o cad-img-top"
                                                    aria-hidden="true "
                                                    style="font-size: 80px; "></i>
                                            </a>
                                            <a [href]="item.url_location"
                                                target="_blank"
                                                rel="noopener noreferrer">
                                                <i *ngIf="item.type ==='docx'"
                                                    class="text-center"
                                                    class="fa fa-file-word-o"
                                                    aria-hidden="true"
                                                    style="font-size: 80px;"></i>
                                            </a>
                                            <p style="margin-top: 10px;">
                                                {{item.descricao}}</p>
                                        </div>

                                        <button style="margin-bottom: 15px;"
                                            class="btn btn-danger form-control"
                                            data-toggle="modal"
                                            data-target="#exampleModalLong"
                                            (click)="dados(item, i)">
                                            <span
                                                class="spinner-border spinner-border-sm"
                                                role="status"
                                                [ngClass]="{ spinnerLoading: loadingRemove[i] }"
                                                aria-hidden="true"></span>
                                            <i [ngClass]="{ spinnerLoading: !loading }"
                                                aria-hidden="true"></i> Remover
                                        </button>
                                    </div>
                                </div>

                                <div class="modal fade" tabindex="-1"
                                    id="exampleModalLong" role="dialog"
                                    tabindex="-1"
                                    aria-labelledby="exampleModalLong"
                                    aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div
                                                class="modal-header bg-danger text-white">
                                                Excluir Item
                                                <button type="button"
                                                    class="close"
                                                    data-dismiss="modal"
                                                    aria-label="Close">
                                                    <span
                                                        aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <h5>Tem certeza que deseja
                                                    excluir esse anexo.</h5>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button"
                                                    class="btn btn-success"
                                                    data-dismiss="modal">Cancelar</button>
                                                <button type="button"
                                                    class="btn btn-danger"
                                                    data-dismiss="modal"
                                                    (click)="apagarArquivo()">Apagar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal fade bd-example-modal-lg"
                                tabindex="-1" role="dialog"
                                aria-labelledby="myLargeModalLabel"
                                aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div *ngIf="item" class="modal-header">
                                            <b>{{item.descricao}}</b>
                                            <button type="button"
                                                class="close iconeFechar"
                                                data-dismiss="modal"
                                                aria-label="Close">
                                                <span
                                                    aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div *ngIf="item" class="modal-body">
                                            <div class="text-center"
                                                style="margin: 5px 0 25px">
                                                <a [href]="item.url_location"
                                                    target="_blank"
                                                    rel="noopener noreferrer">
                                                    <img src="{{item.url_location}}"
                                                        class="cad-img-top"
                                                        id="imd"
                                                        style="max-width: 100%; max-height: 90vh" />
                                                </a>
                                            </div>
                                            <textarea
                                                *ngIf="item.descricao_completa"
                                                style="width: 100%;"
                                                [readonly]="true">Descrição : {{item.descricao_completa}}</textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>