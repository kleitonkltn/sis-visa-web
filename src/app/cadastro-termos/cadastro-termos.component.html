<body class="body">
    <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
            <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">Dados</a>
            <a class="nav-item nav-link" id="nav-procedimento-tab" data-toggle="tab" href="#nav-procedimento" role="tab" aria-controls="nav-procedimento" aria-selected="false">Termos</a>
            <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">Anexos</a>
        </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
            <div class="row" style="margin-left: 2%; margin-right: 2%;">
                <div class="col-md-1"></div>
                <div class="col-md-10 border">
                    <div class="responsiva" style="margin-bottom: 50px;">
                        <h4 class="text-center" style="margin-bottom: 25px;"> Campos com (*) são obrigatórios </h4>
                    </div>
                    <form method="post" [formGroup]="termosForm">
                        <fieldset>
                            <div class="row">
                                <div class="form-group col-md-2">
                                    <b>*CNPJ ou CPF:</b>
                                    <input class="form-control" [textMask]="{mask: cnpjmask}" formControlName="cnpj" name="cnpj" [ngClass]="{'form-submitted': formSubmitted}">
                                </div>

                                <div class="form-group col-md-5">
                                    <b>*Nome Fantasia:</b>
                                    <input class="form-control" formControlName="fantasia" name="fantasia" [ngClass]="{'form-submitted': formSubmitted}">
                                </div>
                                <div class="form-group col-md-5">
                                    <b>*Razão Social:</b>
                                    <input class="form-control" type="text" formControlName="razao" name="razao" [ngClass]="{'form-submitted': formSubmitted}">
                                </div>
                            </div>

                            <div class="row">
                                <div class="form-group col-md-4">
                                    <b>E-mail:</b>
                                    <input class="form-control" formControlName="email" type="email" name="email">
                                </div>
                                <div class="form-group col-md-3">
                                    <b>IE ou RG:</b>
                                    <input class="form-control" formControlName="insc" name="insc">
                                </div>
                                <div class="form-group col-md-5">
                                    <b>*Endereço:</b>
                                    <input class="form-control" formControlName="endereco" name="endereco" [ngClass]="{'form-submitted': formSubmitted}">
                                </div>
                            </div>

                            <div class="row">

                                <div class="form-group col-md-3">
                                    <b>*Bairro:</b>
                                    <input class="form-control" formControlName="bairro" name="bairro" type="text" [ngClass]="{'form-submitted': formSubmitted}">
                                </div>
                                <div class="form-group col-md-3">
                                    <b>*Municipio:</b>
                                    <input class="form-control" formControlName="municipio" name="municipio" type="text" [ngClass]="{'form-submitted': formSubmitted}">
                                </div>
                                <div class="form-group col-md-3">
                                    <b>*Telefone:</b>
                                    <input class="form-control" [textMask]="{mask: contatomask}" formControlName="telefone" name="telefone" type="text" [ngClass]="{'form-submitted': formSubmitted}">
                                </div>

                                <div class="form-group col-md-3">
                                    <b>*Ramo/Atividade:</b>
                                    <div id="alvo">
                                        <select id="select" formControlName="ramo" name="ramo" class="custom-select" [ngClass]="{'form-submitted': formSubmitted}">
                                            <option *ngFor="let atividade of atividades" [value]="atividade.id">
                                                {{atividade.atividade}}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-procedimento" role="tabpanel" aria-labelledby="nav-procedimento-tab" align="center">
            <div style="margin-left: 2%; margin-right: 2%;">
                <div class="border col-sm-9 text-left">
                    <div class="responsiva" style="margin-bottom: 50px;">
                        <h1 class="text-center">{{titulo}}</h1>
                        <h4 class="text-center" style="margin-bottom: 25px;"> Campos com (*) são obrigatórios </h4>
                    </div>
                    <form method="POST" [formGroup]="termosForm">
                        <div class="row">
                            <div class="form-group col-sm-4">
                                <b>Data:</b>
                                <input class="form-control" formControlName="data" name="data" type="date" disabled>
                            </div>

                            <div class="form-group col-sm-4">
                                <b>Hora:</b>
                                <input class="form-control" formControlName="hora" name="hora" type="time" disabled>
                            </div>
                            <div class="form-group col-sm-4">
                                <b>*Termo de:</b>
                                <div id="alvo">
                                    <select name="origem" id="select" formControlName="tipo_termo" name="tipo_termo" class="custom-select" [ngClass]="{'form-submitted': formSubmitted}">
                                <option value="constatacao">Constatação</option>
                                <option value="inspecao">Inspeção</option>    
                                <option value="inutilizacao">Inutilização </option> 
                                <option value="notificacao">Notificação</option>                       
                                <option value="orientacao"> Orientação  </option>
                                <option value="infracao">Infração</option>
                                <option value="relatorio">Relatório</option>
                                <option value="desinterdicao">Desinterdição</option>
                                <option value="interdicao">Interdição</option>
                                </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-sm-4">
                                <b>Nome do Responsável:</b>
                                <input class="form-control" formControlName="responsavel_nome" name="responsavel_nome" type="text">
                            </div>
                            <div class="form-group col-sm-4">
                                <b>RG do Responsável:</b>
                                <input class="form-control" formControlName="responsavel_rg" name="responsavel_rg" type="text">
                            </div>
                            <div class="form-group col-sm-4">
                                <b>Doc Classe Responsável:</b>
                                <input class="form-control" formControlName="responsavel_classe" name="responsavel_classe" type="text">
                            </div>

                        </div>
                        <div class="row">
                            <div class="form-group col-sm-4">
                                <b>Nome do Propiretário:</b>
                                <input class="form-control" formControlName="proprietario_nome" name="proprietario_nome" type="text">
                            </div>
                            <div class="form-group col-sm-4">
                                <b>RG Propiretário:</b>
                                <input class="form-control" formControlName="proprietario_rg" name="proprietario_rg" type="text">
                            </div>
                            <div class="form-group col-sm-4">
                                <b>Doc Classe Propiretário:</b>
                                <input class="form-control" formControlName="proprietario_classe" name="proprietario_classe" type="text">
                            </div>
                            <div class="form-group col-sm-6" *ngIf="!id_termo">
                                <b>*Embasamentos:</b>
                                <div id="alvo">
                                    <select name="origem" id="selectEm" class="js-example-basic-multiple custom-select" multiple="multiple" style="width: 100%;">
                                        <option *ngFor="let embasamento of embasamentos" [value]="embasamento.descricao_completa">
                                            {{embasamento.descricao}}
                                        </option>                                    
                                </select>
                                </div>
                            </div>
                            <div class="form-group col-sm-6">
                                <b>*Embasamentos Legal:</b>
                                <textarea class="form-control" [(ngModel)]="textSearch" formControlName="embasamento_legal" name="embasamento_legal" type="text" [ngClass]="{'form-submitted': formSubmitted}"></textarea>
                            </div>

                            <div class="form-group col-sm-12" *ngIf="!id_termo">
                                <b>Documentos:</b>
                                <select name="doc" class="select-doc custom-select" multiple="multiple" style="width: 100%;">
                                    <option *ngFor="let documento of documentos" [value]="documento.descricao_completa">
                                        {{documento.descricao}}</option>
                                  </select>
                            </div>
                            <div class="form-group col-sm-12">
                                <b>*Descrição:</b>
                                <textarea class="form-control" rows="5" [(ngModel)]="desc" formControlName="descricao" name="descricao" type="text" [ngClass]="{'form-submitted': formSubmitted}"></textarea>
                            </div>
                            <div class="form-group col-sm-6" *ngIf="!id_termo">
                                <b>*Fiscais Presente:</b>
                                <select name="origem" id="selectfiscais" class="select-fiscais custom-select" multiple="multiple" style="width: 100%;">
                                    <option *ngFor="let fiscais of fiscais" [value]="fiscais.matricula">
                                        {{fiscais.nome}}
                                    </option>
                            </select>
                            </div>
                            <div class="form-group col-sm-6">
                                <b>*Fiscal responsável:</b>
                                <input class="form-control" formControlName="fiscal_responsavel" name="fiscal_responsavel" type="text" disabled>
                            </div>
                        </div>
                        <div class="text-center">
                            <div *ngIf="id_termo  == null">
                                <button type="button" class="btn btn-dark" value="Cadastrar" (click)="salvar()">
                                    <span class="spinner-border spinner-border-sm" role="status" [ngClass]="{ spinnerLoading: loadingCadastro }" aria-hidden="true"></span>
                                    <i [ngClass]="{ spinnerLoading: !loading }" aria-hidden="true"></i> Cadastrar
                                </button>
                            </div>
                            <div *ngIf="id_termo  > 0">
                                <button type="submit" class="btn btn-dark" value="Atualizar" (click)="atualizar()">
                                    <span class="spinner-border spinner-border-sm" role="status" [ngClass]="{ spinnerLoading: loadingCadastro }" aria-hidden="true"></span>
                                    <i [ngClass]="{ spinnerLoading: !loading }" aria-hidden="true"></i> Atualizar
                            </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
            <div style="margin-left: 2%; margin-right: 2%;">
                <div style="margin-top:10px;" align="center">
                    <input type="file" id="teste" style="display: block;" class="text-center" (change)="onUploadChange($event)" accept=".png, .jpg, .jpeg, .pdf, .docx" multiple>
                </div>
                <div class="col-md-12" style="margin-left: 20px;">
                    <div class="row">
                        <div class=" t col-md-3" *ngFor="let item of base64textString; let i = index" style="max-width: 285px;">
                            <div class="card-header text-right col-md-12">
                                <i class="fa fa-times" aria-hidden="true " (click)="removerDaLista(i) "></i>
                            </div>
                            <div class="card">
                                <div align="center">
                                    <button *ngIf="arq[i]==='image/png' || arq[i]==='image/jpeg' " data-toggle="modal" class="max-height: 5rem" data-target=".bd-example-modal-lg" (click)="verAnexoCarregado(i)">
                                        <img  class="text-center " src='data:image/png;base64,{{base64textString[i]}}' alt=" " class="cad-img-top " id="img " style="max-width: 100%; max-height: 80px;
                                        min-width: 80px; ">
                                  </button>

                                    <i *ngIf="arq[i]==='application/pdf' " class="text-center " class="fa fa-file-pdf-o fa-5x "></i>
                                    <i *ngIf="arq[i]==='application/vnd.openxmlformats-officedocument.wordprocessingml.document' " class="text-center " class="fa fa-file-word-o fa-5x " aria-hidden="true "></i>
                                    <p align="center" style="margin-top: 10px; ">{{nomeArquivo[i]}}</p>

                                </div>
                                <input class="form-control " type="text " [(ngModel)]="descricao[i] " placeholder="Adicionar Descrição " name="descricao_completa ">
                                <button class="btn btn-dark form-control " id="btn " value="Enviar Arquivo " (click)="enviar(item, i) ">
                    <span class="spinner-border spinner-border-sm " role="status " [ngClass]="{ spinnerLoading: loading[i]} " aria-hidden="true "></span>
                    <i [ngClass]="{ spinnerLoading: !loading } " aria-hidden="true "></i> Enviar Arquivo
                            </button>

                            </div>
                        </div>
                    </div>
                    <div *ngIf="base64textString.length> 1" class="text-center">
                        <input type="submit" class="btn btn-dark" value="Enviar Arquivos" (click)="enviarTodos()">
                    </div>
                </div>
                <div class="col-md-12" style="border-top: 1px solid #bdc3c7; margin-top: 50px; margin-left: 0px !important;">
                    <div align="center" style="margin-top: 10px;">
                        <a (click)=" ListaArq()">
                            <i [ngClass]="{ spinnerLoading: !loadingNumvem }" class="fa fa-cloud-download fa-2x" aria-hidden="tue"></i>
                            <span class="spinner-border spinner-border-sm" role="status" [ngClass]="{ spinnerLoading: loadingNumvem }" aria-hidden="true" style="margin-right: 15px;"></span> Visualizar arquivos já armazenados
                        </a>
                    </div>

                    <div style="margin-left: 20px;">
                        <div class="row">
                            <div class="t col-md-3" style="max-width: 280px" *ngFor="let item of listaArq; let i = index">
                                <div>
                                    <div class="card-header text-right">
                                    </div>
                                    <div class="card">
                                        <div align="center">
                                            <button *ngIf="item.type.toString() === 'png' || item.type.toString() === 'jpeg'" data-toggle="modal" class="max-height: 5rem" data-target=".bd-example-modal-lg" (click)="verAnexo(item)">
                                                <img *ngIf="item.type.toString() ==='jpeg'" class="text-center cad-img-top" src="{{item.url_location}}" id="img " style="max-width: 100%; max-height: 80px; min-width: 80px;" />
                                          </button>
                                            <i *ngIf="item.type.toString() ==='pdf' " class="text-center " class="fa fa-file-pdf-o cad-img-top" aria-hidden="true " style="font-size: 80px; "></i>
                                            <i *ngIf="item.type.toString() ==='docx'" class="text-center" class="fa fa-file-word-o" aria-hidden="true" style="font-size: 80px;"></i>
                                            <p style="margin-top: 10px;">{{item.descricao}}</p>
                                        </div>

                                        <button style="margin-bottom: 15px;" class="btn btn-danger form-control" data-toggle="modal" data-target="#exampleModalLong" (click)="dados(item, i)">
                                     <span class="spinner-border spinner-border-sm" role="status" [ngClass]="{ spinnerLoading: loadingRemove[i] }" aria-hidden="true"></span>
                                     <i [ngClass]="{ spinnerLoading: !loading }" aria-hidden="true"></i> Remover
                                </button>
                                    </div>
                                </div>

                                <div class="modal fade" tabindex="-1" id="exampleModalLong" role="dialog" tabindex="-1" aria-labelledby="exampleModalLong" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header bg-danger text-white">
                                                Excluir Item
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                         <span aria-hidden="true">&times;</span>
                                            </button>
                                            </div>
                                            <div class="modal-body">
                                                <h5>Tem certeza que deseja excluir esse anexo.</h5>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-success" data-dismiss="modal">Cancelar</button>
                                                <button type="button" class="btn btn-danger" data-dismiss="modal" (click)="apagarArquivo()">Apagar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div *ngIf="item" class="modal-header">
                                            <b>{{item.descricao}}</b>
                                            <button type="button" class="close iconeFechar" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                              </button>
                                        </div>
                                        <div *ngIf="item" class="modal-body">
                                            <div class="text-center" style="margin: 5px 0 25px">
                                                <img src="{{item.url_location}}" class="cad-img-top" id="imd" style="max-width: 100%; max-height: 300px" />
                                            </div>
                                            <textarea style="width: 100%;" [readonly]="true">Descrição : {{item.descricao_completa}}</textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>